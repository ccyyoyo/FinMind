# 系統架構

FinMind-Arena 採用分層式架構，將資料擷取、智能體推理、辯論協調與投資洞察輸出各自拆分，確保職責劃分清晰且易於維護。

## 分層流程
1. **資料擷取層**
   - 彙整即時市場、基本面、新聞與社群情緒資料。
   - 將輸入統一轉換為時間序列或事件流格式。
   - 儲存在支援時間序查詢的 PostgreSQL + TimescaleDB 中。
2. **多智能體推理層**
   - 各專責智能體從其專業角度分析已擷取的資料。
   - 產出洞察、推理過程與信心水準。
3. **辯論與共識引擎**
   - 編排多輪辯論（提出觀點、交叉質疑、調和結論）。
   - 匯整各方觀點，形成一致的投資建議。
4. **輸出呈現層**
   - 生成完整的報告與儀表板，提供給最終使用者。
   - 支援 PDF 匯出與互動式網頁體驗。

### 元件職責
- **資料擷取工作者**：依排程或即時需求觸發執行，處理重試機制、API 流量限制與資料結構驗證，再寫入儲存層。
- **資料處理管線**：計算衍生指標（如均線、情緒分數），並將原始資料強化成可供智能體使用的結構。
- **智能體執行環境**：負責推理鏈運行、記錄中間想法，並輸出結構化回應（立場、證據、信心）。
- **共識層**：套用權重準則、解決衝突，並把摘要與決策寫回知識庫。
- **呈現層**：讀取最新決策資料包，渲染圖表、辯論紀錄與可下載的產物。

### 跨層注意事項
- **機密管理**：透過金鑰保管服務或加密環境變數保存 API 金鑰與模型憑證。
- **可觀測性**：蒐集資料擷取吞吐量、智能體延遲與辯論結果等日誌與指標。
- **可擴展性**：當併發量增加時，以工作佇列（如 Celery、BullMQ）解耦耗時的資料擷取或推論流程。
- **備援策略**：定義資料來源失效時的安全預設值，確保協調者仍能給出有憑據的結論。

## 建議技術堆疊
| 分層        | 建議技術 | 
|-------------|----------|
| 前端        | Next.js、Tailwind CSS、Chart.js |
| 後端        | FastAPI 或 Node.js、LangChain、Hugging Face Transformers |
| 資料庫      | PostgreSQL + TimescaleDB |
| RAG 向量庫  | Chroma 或 Weaviate |
| 部署        | Zeabur、Render 或 AWS EC2 |
| 模型存取    | HuggingFace Hub、OpenRouter |

## 架構示意
```
[ 使用者 ]
   │
   ▼
前端 (Next.js UI) ──► 後端 API (FastAPI / Node)
   │                          │
   │                          ├── 多智能體協調器
   │                          ├── 資料擷取服務
   │                          ├── RAG 記憶體管理
   │                          └── 報告產生器
   │
   ├── 視覺化與報告
   ▼
雲端服務與外部 API
   ├── 金融資料來源 (Yahoo、Finnhub、Alpha Vantage)
   ├── 新聞與社群 API (NewsAPI、Reddit、Twitter、StockTwits)
   ├── 託管模型 (HuggingFace Hub、OpenRouter)
   └── 向量資料庫 (Chroma、Weaviate)
```
